<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Smart-In App </title>

  <!-- Leaflet CSS & JS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- VectorGrid plugin -->
  <script src="https://unpkg.com/leaflet.vectorgrid/dist/Leaflet.VectorGrid.bundled.js"></script>

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root{
      --bg-1: #060709;
      --bg-2: #0e1114;
      --card: rgba(255,255,255,0.03);
      --glass-border: rgba(255,255,255,0.06);
      --accent: #ff3b30;
      --muted: rgba(255,255,255,0.6);
      --shadow: 0 10px 30px rgba(0,0,0,0.6);
      font-family: "Inter", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    html,body{
      height:100%;
      margin:0;
      background: linear-gradient(180deg,var(--bg-1),var(--bg-2));
      color:#eaeef7;
      overflow:hidden;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    .dashboard { height:100vh; width:100vw; display:flex; gap:20px; padding:20px; box-sizing:border-box; align-items:stretch; justify-content:center; }

    .left { width:240px; min-width:180px; display:flex; flex-direction:column; gap:18px; }
    .brand { background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:14px; padding:16px; box-shadow: var(--shadow); border:1px solid var(--glass-border); }
    .brand h1{ margin:0; font-size:18px; color:#ffd84d; }
    .brand p{ margin:6px 0 0 0; color:var(--muted); font-size:13px; }

    .controls { display:flex; flex-direction:column; gap:10px; }
    .btn { padding:10px 12px; border-radius:10px; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06)); border:1px solid rgba(255,255,255,0.03); color:#eef6ff; cursor:pointer; font-weight:600; box-shadow: 6px 6px 16px rgba(0,0,0,0.6), -4px -4px 10px rgba(255,255,255,0.02); transition: transform .12s ease, box-shadow .12s ease; text-align:center; }
    .btn:active{ transform:translateY(1px); }
    .btn.secondary{ background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.08)); border:1px solid rgba(255,255,255,0.02); }

    .center { flex:1; display:flex; flex-direction:column; gap:14px; min-width:400px; }
    .map-card { flex:1; border-radius:50%; position:relative; display:flex; align-items:center; justify-content:center; overflow:visible; }

    .map-wrapper { width:100%; max-width:650px; aspect-ratio:1/1; display:flex; align-items:center; justify-content:center; position:relative; z-index:1; }

    .map-circle { width:100%; height:100%; border-radius:50%; overflow:hidden; display:flex; align-items:center; justify-content:center; }
    #map { width:100%; height:100%; border-radius:50%; filter: brightness(1) saturate(5) hue-rotate(250deg); }

    .right { width:220px; min-width:220px; display:flex; flex-direction:column; gap:18px; }

    .dropdown { display:none; flex-direction:column; margin-top:6px; gap:4px; background: rgba(255,255,255,0.05); padding:6px 8px; border-radius:10px; border:2px solid rgba(255,255,255,0.03); cursor:pointer; }
    .dropdown div:hover { background: rgba(255,255,255,0.1); }

    .foliumtooltip { background: rgba(10,10,12,0.95); color:#fff; border-radius:8px; padding:8px 10px; border:2px solid rgba(255,255,255,0.04); }

    .leaflet-control-container {
  position: absolute !important;
  top: 110px !important;
  left: 70px !important;
  z-index: 9999;
  border: 2px;
} /* sets zoom control inside the map circle */

.leaflet-control-attribution {
  opacity: 0 !important;
  pointer-events: none !important; /* makes leaflet reference invisible */
}

    @media (max-width:1000px){
      .dashboard{ flex-direction:column; padding:12px; gap:12px; }
      .left, .right { width:100%; display:flex; flex-direction:row; gap:10px; }
      .left { justify-content:space-between; }
      .right { justify-content:space-between; }
      .center { width:100%; min-width:0; }
      #map { border-radius:12px; height:calc(70vh); }
    }
  </style>
</head>

<body>
  <div class="dashboard">
    <div class="left">
      <div class="brand">
        <h1>Vadilion Digital</h1>
        <p>Smart-In — Brussels dashboard</p>
      </div>
      <div class="controls">
        <button id="btn-theme" class="btn">Theme</button>
        <div id="theme-dropdown" class="dropdown">
          <div data-theme="sales">Sales</div>
          <div data-theme="rents">Rents</div>
          <div data-theme="social">Social & Economic</div>
          <div data-theme="commerces">Commerces</div>
          <div data-theme="bati">Bâti</div>
          <div data-theme="security">Security</div>
          <div data-theme="pollution">Pollution</div>
          <div data-theme="green">Green/Blue</div>
        </div>

        <button id="btn-filters" class="btn">Filtres</button>
        <div id="filters-dropdown" class="dropdown">
          <div id="filters-content">choose a theme</div>
        </div>
      </div>
    </div>

    <div class="center">
      <div class="map-card">
        <div class="map-background"></div>
        <div class="map-wrapper">
          <div class="map-circle">
            <div id="map" class="folium-map"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="right">
      <div class="legend">


      </div>
      <div class="controls">
        <button id="btn-center" class="btn">Center map</button>
        <button id="btn-toggle" class="btn secondary">Polygones OFF</button>
      </div>
    </div>
  </div>

  <script>
    // --- initialize map ---
    var map = L.map('map').setView([50.85, 4.35], 10);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    map.whenReady(function () {
    const controls = document.querySelector('.leaflet-control-container');
    const wrapper = document.querySelector('.map-wrapper');

    if (controls && wrapper) {
        wrapper.appendChild(controls);
    }
});


    // Leaflet controls inside circle
    var leafletControls = document.querySelector('.leaflet-control-container');
    document.querySelector('.map-wrapper').appendChild(leafletControls);

    // vector tiles
    var vectorTileLayer = L.vectorGrid.protobuf(
        "../vector_tiles/{z}/{x}/{y}.pbf",
        { debug:true, interactive:true }
    ).addTo(map);

    vectorTileLayer.on('click', function(e){
        if(e.layer && e.layer.properties){
            var props = e.layer.properties;
            var tooltipText = Object.keys(props).slice(0,5).map(k => k + ": " + props[k]).join("\n");
            alert(tooltipText);
        }
    });

    // UI interactions
    document.getElementById('btn-center').addEventListener('click', function(){ map.setView([50.85,4.35],10); });

    var polygonsOn = true;
    document.getElementById('btn-toggle').addEventListener('click', function(){
      if(polygonsOn){ map.removeLayer(vectorTileLayer); polygonsOn=false; this.classList.add('secondary'); this.innerText='Polygones OFF'; }
      else { vectorTileLayer.addTo(map); polygonsOn=true; this.classList.remove('secondary'); this.innerText='Toggle polygons'; }
    });

    // Theme dropdown
    document.getElementById('btn-theme').addEventListener('click', function(){
      var dd = document.getElementById('theme-dropdown');
      dd.style.display = dd.style.display==='flex'?'none':'flex';
    });

    // Filters dropdown
    document.getElementById('btn-filters').addEventListener('click', function(){
      var dd = document.getElementById('filters-dropdown');
      dd.style.display = dd.style.display==='flex'?'none':'flex';
    });

    // table mapping theme -> filters
    const themeFilters = {
      sales: ['house', 'appart'],
      rents: ['house', 'appart'],
      social: ['quantity','work status','occupation','revenue','age group'],
      commerces: ['boutiques','fabrics'],
      bati: ['houses','appartments','hlm'],
      security: ['crimes','violence','incivilité'],
      pollution: ['air','noise'],
      green: ['travel time','distance']
    };

    // click sur un thème -> mise à jour des filtres
    document.querySelectorAll('#theme-dropdown div').forEach(el => {
      el.addEventListener('click', function(){
        var theme = this.dataset.theme;
        var filtersDiv = document.getElementById('filters-content');
        var filters = themeFilters[theme] || [];
        filtersDiv.innerHTML = filters.length>0 ? filters.join(', ') : 'choose a theme';
        document.getElementById('theme-dropdown').style.display = 'none';
      });
    });

    // resize
    window.addEventListener('resize', function(){ setTimeout(function(){ map.invalidateSize(); },200); });
    window._map = map;
    window._vTile = vectorTileLayer;
  </script>
</body>
</html>
